
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Controlling the copter from Arduino Â· Clever</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Copter Express">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-richquotes/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="3g.html" />
    
    
    <link rel="prev" href="autolaunch.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="gloss.html">
            
                <a href="gloss.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Assembly
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="assemble_2.html">
            
                <a href="assemble_2.html">
            
                    
                    Clever 2 assembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="assemble_3.html">
            
                <a href="assemble_3.html">
            
                    
                    Clever 3 assembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="fpv.html">
            
                <a href="fpv.html">
            
                    
                    Installation of FPV
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="safety.html">
            
                <a href="safety.html">
            
                    
                    Safety instruction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="4in1.html">
            
                <a href="4in1.html">
            
                    
                    Connecting 4 in 1 ESCs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="connectortypes.html">
            
                <a href="connectortypes.html">
            
                    
                    Types of power connectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="zap.html">
            
                <a href="zap.html">
            
                    
                    Blanching
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="tb.html">
            
                <a href="tb.html">
            
                    
                    Soldering safety
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="test_connection.html">
            
                <a href="test_connection.html">
            
                    
                    Using multimeter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="radioerrors.html">
            
                <a href="radioerrors.html">
            
                    
                    Possible radio failures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="gps.html">
            
                <a href="gps.html">
            
                    
                    Connecting GPS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Configuration
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="setup.html">
            
                <a href="setup.html">
            
                    
                    Initial setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="modes.html">
            
                <a href="modes.html">
            
                    
                    Flight modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="firmware.html">
            
                <a href="firmware.html">
            
                    
                    Pixhawk / Pixracer Firmware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="px4_parameters.html">
            
                <a href="px4_parameters.html">
            
                    
                    PX4 Parameters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="calibratePID.html">
            
                <a href="calibratePID.html">
            
                    
                    PID Setup
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Work with Raspberry Pi
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="raspberry.html">
            
                <a href="raspberry.html">
            
                    
                    Raspberry Pi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="microsd_images.html">
            
                <a href="microsd_images.html">
            
                    
                    RPi Image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="connection.html">
            
                <a href="connection.html">
            
                    
                    RPi Connection to the Pixhawk
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="wifi.html">
            
                <a href="wifi.html">
            
                    
                    Wi-Fi connection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="ssh.html">
            
                <a href="ssh.html">
            
                    
                    SSH access to Raspberry Pi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="network.html">
            
                <a href="network.html">
            
                    
                    Configuring Wi-Fi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="gcs_bridge.html">
            
                <a href="gcs_bridge.html">
            
                    
                    Using QGroundControl via Wi-Fi
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="rc.html">
            
                <a href="rc.html">
            
                    
                    Controlling Clever from a smartphone
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="uart.html">
            
                <a href="uart.html">
            
                    
                    UART settings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="web_video_server.html">
            
                <a href="web_video_server.html">
            
                    
                    Viewing images from cameras
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="frames.html">
            
                <a href="frames.html">
            
                    
                    Coordinate systems (frames)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Coding
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="ros.html">
            
                <a href="ros.html">
            
                    
                    ROS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="mavros.html">
            
                <a href="mavros.html">
            
                    
                    MAVROS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="simple_offboard.html">
            
                <a href="simple_offboard.html">
            
                    
                    Simple OFFBOARD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="aruco.html">
            
                <a href="aruco.html">
            
                    
                    Navigation using ArUco markers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="selfcheck.html">
            
                <a href="selfcheck.html">
            
                    
                    Automatic check
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="snippets.html">
            
                <a href="snippets.html">
            
                    
                    Code examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="camera_frame.html">
            
                <a href="camera_frame.html">
            
                    
                    Adjusting the position of the main camera
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="camera.html">
            
                <a href="camera.html">
            
                    
                    Working with the camera
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="leds.html">
            
                <a href="leds.html">
            
                    
                    Working with a LED strip on Raspberry 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="rviz.html">
            
                <a href="rviz.html">
            
                    
                    Using rviz and rqt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="sonar.html">
            
                <a href="sonar.html">
            
                    
                    Working with the ultrasonic distance gage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="sitl.html">
            
                <a href="sitl.html">
            
                    
                    PX4 Simulation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="autolaunch.html">
            
                <a href="autolaunch.html">
            
                    
                    Software autorun
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.14" data-path="arduino.html">
            
                <a href="arduino.html">
            
                    
                    Controlling the copter from Arduino
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="3g.html">
            
                <a href="3g.html">
            
                    
                    Using an external 3G modem
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Clever-based projects
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="shield.html">
            
                <a href="shield.html">
            
                    
                    Copter spheric guard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="copterhack2018.html">
            
                <a href="copterhack2018.html">
            
                    
                    Copter Hack 2018
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="copterhack2017.html">
            
                <a href="copterhack2017.html">
            
                    
                    Copter Hack 2017
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Supplementary materials
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="contributing.html">
            
                <a href="contributing.html">
            
                    
                    Contribution to Clever
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="esc_firmware.html">
            
                <a href="esc_firmware.html">
            
                    
                    Flashing ESCs using BLHeliSuite
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="mavlink.html">
            
                <a href="mavlink.html">
            
                    
                    MAVLink
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="flight_logs.html">
            
                <a href="flight_logs.html">
            
                    
                    PX4 Logs and Topics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Textbook
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="lessons.html">
            
                <a href="lessons.html">
            
                    
                    Theory and Videos
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Controlling the copter from Arduino</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="controlling-the-copter-from-arduino"><a name="controlling-the-copter-from-arduino" class="plugin-anchor" href="#controlling-the-copter-from-arduino"><i class="fa fa-link" aria-hidden="true"></i></a>Controlling the copter from Arduino</h1>
<p>For interaction with ROS topics and services on a Raspberry Pi, you can use the <a href="http://wiki.ros.org/rosserial_arduino" target="_blank">rosserial_arduino</a> library. This library is pre-installed on <a href="microsd_images.html">a Raspberry Pi image</a>.</p>
<p>The main tutorial for rosserial: <a href="http://wiki.ros.org/rosserial_arduino/Tutorials" target="_blank">http://wiki.ros.org/rosserial_arduino/Tutorials</a></p>
<p>Arudino is to be installed on Clever and connected via a USB port.</p>
<h2 id="configuring-arduino-ide"><a name="configuring-arduino-ide" class="plugin-anchor" href="#configuring-arduino-ide"><i class="fa fa-link" aria-hidden="true"></i></a>Configuring Arduino IDE</h2>
<p>To work with ROS and Arduino, you should understand the format of installed packages&apos; messages. For this purpose <a href="ssh.html">on Raspberry Pi</a>, build the ROS messages library:</p>
<pre><code class="lang-(bash)">rosrun rosserial_arduino make_libraries.py.
</code></pre>
<p>The obtained folder <code>ros_lib</code> is to be copied to <code>&lt;sketches folder&gt;/libraries</code> on a computer with Arudino IDE.</p>
<h2 id="configuring-raspberry-pi"><a name="configuring-raspberry-pi" class="plugin-anchor" href="#configuring-raspberry-pi"><i class="fa fa-link" aria-hidden="true"></i></a>Configuring Raspberry Pi</h2>
<p>To run the program on Arduino once, you can use command:</p>
<pre><code class="lang-(bash)">roslaunch clever arduino.launch
</code></pre>
<p>To start the link with Arduino at the startup automatically, set argument <code>arudino</code> in the Clever launch file (<code>~/catkin_ws/src/clever/clever/launch/clever.launch</code>):</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;arduino&quot;</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
</code></pre>
<p>After the launch file is edited, restart package <code>clever</code>:</p>
<pre><code class="lang-(bash)">sudo systemctl restart clever
</code></pre>
<h2 id="delays"><a name="delays" class="plugin-anchor" href="#delays"><i class="fa fa-link" aria-hidden="true"></i></a>Delays</h2>
<p>When <code>rosserial_arduino</code> is used, the Arduino microcontroller should not be blocked for more than a few seconds (for example, using the <code>delay</code> function); otherwise communication between Raspberry Pi and Arduino will be broken.</p>
<p>During implementation of long <code>while</code> cycles, ensure periodic calling the <code>hn.spinOnce</code> function:</p>
<pre><code class="lang-cpp"><span class="hljs-keyword">while</span>(<span class="hljs-comment">/* condition */</span>) {
  <span class="hljs-comment">// ... Perform required actions</span>
  nh.spinOnce();
}
</code></pre>
<p>To organize long delays, use the delays in a loop with periodic calling of the <code>hn.spinOnce()</code> function:</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// 8 second delay</span>
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">8</span>; i++) {
  delay(<span class="hljs-number">1000</span>);
  nh.spinOnce();
}
</code></pre>
<h2 id="working-with-clever"><a name="working-with-clever" class="plugin-anchor" href="#working-with-clever"><i class="fa fa-link" aria-hidden="true"></i></a>Working with Clever</h2>
<p>The set of services and topics is similar to the regular set in <a href="simple_offboard.html">simple_offboard</a> and <a href="mavros.html">mavros</a>.</p>
<p>An example of a program that controls the copter by position using the <code>navigate</code> and <code>set_mode</code> services:</p>
<pre><code class="lang-cpp"><span class="hljs-comment">// Connecting libraries for working with rosseral</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros.h&gt;</span></span>

<span class="hljs-comment">// Connecting Clever and MAVROS package message header files</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;clever/Navigate.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;mavros_msgs/SetMode.h&gt;</span></span>

<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> clever;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> mavros_msgs;

ros::NodeHandle nh;

<span class="hljs-comment">// Declaring services</span>
ros::ServiceClient&lt;Navigate::Request, Navigate::Response&gt; navigate(<span class="hljs-string">&quot;/navigate&quot;</span>);
ros::ServiceClient&lt;SetMode::Request, SetMode::Response&gt; setMode(<span class="hljs-string">&quot;/mavros/set_mode&quot;</span>);

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-comment">// Initializing rosserial</span>
  nh.initNode();

  <span class="hljs-comment">// Initializing services</span>
  nh.serviceClient(navigate);
  nh.serviceClient(setMode);

  <span class="hljs-comment">// Waiting for connection to Raspberry Pi</span>
  <span class="hljs-keyword">while</span>(!nh.connected()) nh.spinOnce();
  nh.loginfo(<span class="hljs-string">&quot;Startup complete&quot;</span>);

  <span class="hljs-comment">// Custom settings</span>
  <span class="hljs-comment">// &lt;...&gt;</span>

  <span class="hljs-comment">// Test program</span>
  Navigate::Request nav_req;
  Navigate::Response nav_res;
  SetMode::Request sm_req;
  SetMode::Response sm_res;

  <span class="hljs-comment">// Ascending to 2 meters:</span>
  nh.loginfo(<span class="hljs-string">&quot;Take off&quot;</span>);
  nav_req.auto_arm = <span class="hljs-literal">false</span>;
  nav_req.x = <span class="hljs-number">0</span>;
  nav_req.y = <span class="hljs-number">0</span>;
  nav_req.z = <span class="hljs-number">2</span>;
  nav_req.frame_id = <span class="hljs-string">&quot;body&quot;</span>;
  nav_req.speed = <span class="hljs-number">0.5</span>;
  navigate.call(nav_req, nav_res);

  <span class="hljs-comment">// Waiting for 5 seconds</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++) {
      delay(<span class="hljs-number">1000</span>);
      nh.spinOnce();
  }

  nav_req.auto_arm = <span class="hljs-literal">false</span>;

  <span class="hljs-comment">// Flying forward 3 meters:</span>
  nh.loginfo(<span class="hljs-string">&quot;Fly forward&quot;</span>);
  nav_req.auto_arm = <span class="hljs-literal">true</span>;
  nav_req.x = <span class="hljs-number">3</span>;
  nav_req.y = <span class="hljs-number">0</span>;
  nav_req.z = <span class="hljs-number">0</span>;
  nav_req.frame_id = <span class="hljs-string">&quot;body&quot;</span>;
  nav_req.speed = <span class="hljs-number">0.8</span>;
  navigate.call(nav_req, nav_res);

  <span class="hljs-comment">// Waiting for 5 seconds</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++) {
    delay(<span class="hljs-number">1000</span>);
    nh.spinOnce();
  }

  <span class="hljs-comment">// Flying to point 1:0:2 in the marker field</span>
  nh.loginfo(<span class="hljs-string">&quot;Fly on point&quot;</span>);
  nav_req.auto_arm = <span class="hljs-literal">false</span>;
  nav_req.x = <span class="hljs-number">1</span>;
  nav_req.y = <span class="hljs-number">0</span>;
  nav_req.z = <span class="hljs-number">2</span>;
  nav_req.frame_id = <span class="hljs-string">&quot;aruco_map&quot;</span>;
  nav_req.speed = <span class="hljs-number">0.8</span>;
  navigate.call(nav_req, nav_res);

  <span class="hljs-comment">// Waiting for 5 seconds</span>
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">5</span>; i++) {
    delay(<span class="hljs-number">1000</span>);
    nh.spinOnce();
  }

  <span class="hljs-comment">// Landing</span>
  nh.loginfo(<span class="hljs-string">&quot;Land&quot;</span>);
  sm_req.custom_mode = <span class="hljs-string">&quot;AUTO.LAND&quot;</span>;
  setMode.call(sm_req, sm_res);
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
}
</code></pre>
<h2 id="getting-telemetry"><a name="getting-telemetry" class="plugin-anchor" href="#getting-telemetry"><i class="fa fa-link" aria-hidden="true"></i></a>Getting telemetry</h2>
<p>With Arduino, you can use the <a href="simple_offboard.html"><code>get_telemetry</code> service</a>. To do so, declare it similar to the <code>navigate</code> and <code>set_mode</code> services:</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros.h&gt;</span></span>

<span class="hljs-comment">// ...</span>

<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;clever/GetTelemetry.h&gt;</span></span>

<span class="hljs-comment">// ...</span>

ros::ServiceClient&lt;GetTelemetry::Request, GetTelemetry::Response&gt; getTelemetry(<span class="hljs-string">&quot;/get_telemetry&quot;</span>);

<span class="hljs-comment">// ...</span>

nh.serviceClient(getTelemetry);

<span class="hljs-comment">// ...</span>

GetTelemetry::Request gt_req;
GetTelemetry::Response gt_res;


<span class="hljs-comment">// ...</span>

gt_req.frame_id = <span class="hljs-string">&quot;aruco_map&quot;</span>; <span class="hljs-comment">// frame id for x, y, z</span>
getTelemetry.call(gt_req, gt_res);

<span class="hljs-comment">// gt_res.x is copter position on the x axis</span>
<span class="hljs-comment">// gt_res.y is copter position on the y axis</span>
<span class="hljs-comment">// gt_res.z is copter position on the z axis</span>
</code></pre>
<h2 id="problem"><a name="problem" class="plugin-anchor" href="#problem"><i class="fa fa-link" aria-hidden="true"></i></a>Problem</h2>
<p>When using Arudino Nano, RAM may be insufficient. In this case, messages will appear in the Aruino IDE like:</p>
<pre><code>Global variables use 1837 bytes (89%) of the dynamic memory, leaving 211 bytes for local variables. The maximum is 2048 bytes.
Not enough memory, the program may be unstable.
</code></pre><p>You can reduce RAM usage by reducing the size of the buffers allocated for sending and receiving messages. To do this, place the following line <strong>at the beginning</strong> the program:</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __AVR_ATmega168__ 1</span>
</code></pre>
<p>You can reduce the amount of used memory even more, if you manually configure the number publishers and subscribers, as well as the size of memory buffers allocated for messages, for example:</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros.h&gt;</span></span>

<span class="hljs-comment">// ...</span>

<span class="hljs-keyword">typedef</span> ros::NodeHandle_&lt;ArduinoHardware, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>&gt; NodeHandle;

<span class="hljs-comment">// ...</span>
NodeHandle nh;
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="autolaunch.html" class="navigation navigation-prev " aria-label="Previous page: Software autorun">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="3g.html" class="navigation navigation-next " aria-label="Next page: Using an external 3G modem">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Controlling the copter from Arduino","level":"1.6.14","depth":2,"next":{"title":"Using an external 3G modem","level":"1.6.15","depth":2,"path":"3g.md","ref":"3g.md","articles":[]},"previous":{"title":"Software autorun","level":"1.6.13","depth":2,"path":"autolaunch.md","ref":"autolaunch.md","articles":[]},"dir":"ltr"},"config":{"plugins":["youtube","richquotes@https://github.com/okalachev/gitbook-plugin-richquotes.git","yametrika","anchors","validate-links","bulk-redirect@https://github.com/okalachev/gitbook-plugin-bulk-redirect.git","sitemap@https://github.com/okalachev/plugin-sitemap.git"],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"yametrika":{"id":49359238},"validate-links":{"defaultScheme":"https","local":"warn","remote":"disabled"},"youtube":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"richquotes":{},"highlight":{},"sitemap":{"hostname":"https://clever.copterexpress.com"},"bulk-redirect":{"basepath":"","redirectsFile":"redirects.json"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"anchors":{}},"theme":"default","author":"Copter Express","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Clever","language":"en","gitbook":"*","description":"ÐÐ¾Ð½ÑÑÑÑÐºÑÐ¾Ñ ÐºÐ²Ð°Ð´ÑÐ¾ÐºÐ¾Ð¿ÑÐµÑÐ° Â«ÐÐ»ÐµÐ²ÐµÑÂ»"},"file":{"path":"arduino.md","mtime":"2019-05-01T19:27:39.707Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-05-01T19:28:35.172Z"},"basePath":".","book":{"language":"en"}});
        });
    </script>
</div>

        
    
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-yametrika/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    <script type='text/javascript'>
        (function (d, w, c) {
            (w[c] = w[c] || []).push(function() {
                try {
                    w.yaCounter49359238 = new Ya.Metrika({"id":49359238});
                } catch(e) { }
            });
            var n = d.getElementsByTagName('script')[0],
                s = d.createElement('script'),
                f = function () {
                    n.parentNode.insertBefore(s, n);
                };

            s.type = 'text/javascript';
            s.async = true;
            s.src = (d.location.protocol == 'https:' ? 'https:' : 'http:') + '//mc.yandex.ru/metrika/watch.js';
            if (w.opera == '[object Opera]') {
                d.addEventListener('DOMContentLoaded', f, false);
            } else {
                f();
            }
        })(document, window, 'yandex_metrika_callbacks');
    </script>
    <noscript>
        <div>
            <img src="//mc.yandex.ru/watch/49359238" style="position:absolute; left:-9999px;" alt=""/>
        </div>
    </noscript>

    </body>
</html>

